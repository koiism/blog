---
import Layout from '@/layouts/Layout.astro';
import client from 'tina/__generated__/client';
import type { PostConnectionEdges } from 'tina/__generated__/types';
import { Code } from 'astro:components';
import { getPostById } from '@/schemas';
import { PostContent } from '@/components/PostContent';

interface Props {
  entry: PostConnectionEdges,
}

export async function getStaticPaths() {
  const posts = await client.queries.postConnection();
  const entries = posts.data.postConnection.edges || [];

  return entries.map((entry) => ({
    params: { slug: entry?.node?._sys?.filename },
    props: { entry },
  }));
}
const { entry } = Astro.props;

const filename = entry.node?._sys.basename || '';
const posts = await getPostById(filename);

---

<Layout title="post">
  <PostContent post={posts} client:load/>
</Layout>
